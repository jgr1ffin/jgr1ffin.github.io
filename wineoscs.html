<!DOCTYPE HTML>
<html>
	<head>
		<title>Post - ITSM ServiceNow Blog</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="assets/css/main.css" />
	</head>
	<body class="single is-preload">

		<!-- Wrapper -->
			<div id="wrapper">

				<!-- Header -->
				<header id="header">
					<h1><a href="index.html"><i class="fa fa-home">&nbsp;</i>Posts</a></h1>
					<nav class="links">
						<ul>
							<li><a href="#">Business Rules</a></li>
							<li><a href="#">Client Scripts</a></li>
							<li><a href="#">UI Actions</a></li>
							<li><a href="#">Reporting</a></li>
							<li><a href="#">Other</a></li>
						</ul>
					</nav>
				</header>

				<!-- Main -->
					<div id="main">

						<!-- Post -->
							<article class="post">
								<header>
									<div class="title">
										<h2><a href="#">Inform the Help Desk when computers are out of compliance</a></h2>
										<p>Inform & style the Incident form when the associated computer is out of compliance (e.g., Windows 7).</p>
									</div>
									<div class="meta">
										<time class="published" datetime="2019-08-01">August 1, 2019</time>
										<a href="#" class="author"><span class="name">JGriffin</span><img src="images/avatar.jpg" alt="Griffin avatar" /></a>
									</div>
								</header>
								<!--<span class="image featured"><img src="images/pic01.jpg" alt="" /></span>-->
								<p>This script was created to help with the remediation of Windows 7 end of support. The script is designed to inform the Help Desk when a 
									customers computer is out of configuration compliance.
								</p>
								<h4 id="code-block-with-backticks">Client Script:</h4>
								<pre>
									<code class="language-javascript">
function onChange(control, oldValue, newValue, isLoading, isTemplate) {
	
	// agent workspace check - agentworkspace (mobile) or old ui (desktop)
	var env = typeof g_form.initialize === 'undefined' ? 'mobile' : 'desktop';
	if (env == 'mobile') {
		if (isLoading || newValue === '') {
			return;
		} else {
			assocCompDetails();
		}
	} else if (isLoading || newValue === '') {
		var assocCompField = g_form.getControl('sys_display.incident.u_assoc_comp_ci');
		g_form.removeDecoration('u_assoc_comp_ci', 'icon-alert', 'Alert');
		g_form.hideFieldMsg('u_assoc_comp_ci');
		assocCompField.style.fontWeight = 'normal';
		assocCompField.style.backgroundColor = 'white';
		return;
	} else {
		assocCompDetails();
	}
}
	
function assocCompDetails(env) {
	// creates an instance of the GlideAjax object AssociatedCompUtils
	// calls the assocCompObj method and passes the assoc comp sys_id
	var assocCompID = g_form.getValue('u_assoc_comp_ci');
	var assocCompGA = new GlideAjax('AssociatedCompUtils');
	assocCompGA.addParam('sysparm_name', 'assocCompObj');
	assocCompGA.addParam('sysparm_assoc_comp_id', assocCompID);
	assocCompGA.getXML(assocCompAlert);
}

function assocCompAlert(response) {
	// extracts the answer and creates an object from the JSON formatted string
	var answer = response.responseXML.documentElement.getAttribute('answer');
	var compDetailsObj = JSON.parse(answer);
	
	// agent workspace check
	var env = typeof g_form.initialize === 'undefined' ? 'mobile' : 'desktop';
	
	// selects the assoc comp field
	var assocCompField = g_form.getControl('sys_display.incident.u_assoc_comp_ci');
	
	// inform and style the assoc comp field for win7 or unmanaged computers
	if (compDetailsObj[0].os && compDetailsObj[0].os.indexOf("Windows 7") > -1) {
		if (env == 'mobile') {
			g_form.addInfoMessage("Alert: Windows 7 computer (requires remediation)");
		} else {
			g_form.addDecoration('u_assoc_comp_ci', 'icon-alert', 'Alert');
			g_form.showFieldMsg('u_assoc_comp_ci', "Alert: Windows 7 computer (requires remediation)");
			assocCompField.style.fontWeight = 'bold';
			assocCompField.style.backgroundColor = 'orange';
		}
	} else if (compDetailsObj[0].manufacturer.indexOf("Apple") > -1 && (compDetailsObj[0].os == null || compDetailsObj[0].discoverySrc.indexOf("SCCM") == -1)) {
		if (env == 'mobile') {
			g_form.addInfoMessage("Alert: Unmanaged Mac (requires JAMF)");
		} else {
			g_form.addDecoration('u_assoc_comp_ci', 'icon-alert', 'Alert');
			g_form.showFieldMsg('u_assoc_comp_ci', "Alert: Unmanaged Mac (requires JAMF)");
			assocCompField.style.fontWeight = 'bold';
			assocCompField.style.backgroundColor = 'orange';
		}
	} else {
		// reset if neither
		if (env == 'mobile') {
			g_form.clearMessages();
		} else {
			g_form.removeDecoration('u_assoc_comp_ci', 'icon-alert', 'Alert');
			g_form.hideFieldMsg('u_assoc_comp_ci');
			assocCompField.style.fontWeight = 'normal';
			assocCompField.style.backgroundColor = 'white';
		}
	}
}
									</code>
								</pre>
							</article>

					</div>

				<!-- Footer -->
					<section id="footer">
						<ul class="icons">
							<li><a href="https://www.linkedin.com/in/jon-griffin-71124814" class="fab fa-linkedin-in"><span class="label">LinkedIn</span></a></li>
							<li><a href="mailto:jgriff@gmail.com?subject=ServiceNow Blog" class="icon solid fa-envelope"><span class="label">Email</span></a></li>
						</ul>
						<p class="copyright">&copy; Images: <a href="http://unsplash.com">Unsplash</a>.</p>
					</section>

			</div>

		<!-- Scripts -->
			<script src="assets/js/jquery.min.js"></script>
			<script src="assets/js/browser.min.js"></script>
			<script src="assets/js/breakpoints.min.js"></script>
			<script src="assets/js/util.js"></script>
			<script src="assets/js/main.js"></script>
			<script src="assets/js/prism.js"></script>

	</body>

</html>