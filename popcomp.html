<!DOCTYPE HTML>
<html>
	<head>
		<title>ITSM ServiceNow Blog</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="assets/css/main.css" />
	</head>
	<body class="single is-preload">

		<!-- Wrapper -->
			<div id="wrapper">

				<!-- Header -->
				<header id="header">
					<h1><a href="index.html">Posts</a></h1>
					<nav class="links">
						<ul>
							<li><a href="#">Business Rules</a></li>
							<li><a href="#">Client Scripts</a></li>
							<li><a href="#">UI Actions</a></li>
							<li><a href="#">Reporting</a></li>
							<li><a href="#">Other</a></li>
						</ul>
					</nav>
				</header>

				<!-- Main -->
					<div id="main">

						<!-- Post -->
							<article class="post">
								<header>
									<div class="title">
										<h2><a href="#">Quickly populate the associated Task computer</a></h2>
										<p>Automatically populate the callers primary assigned computer.</p>
									</div>
									<div class="meta">
										<time class="published" datetime="2019-08-01">August 1, 2019</time>
										<a href="#" class="author"><span class="name">JGr1ffin</span><img src="images/avatar.jpg" alt="Griffin avatar" /></a>
									</div>
								</header>
								<!--<span class="image featured"><img src="images/pic01.jpg" alt="" /></span>-->
								<p>This script was devloped to help IT staff quickly populate the callers assigned computer asset, which is most likely the computer associated with
								 the Incident/Task.
								</p>
								<pre>
									<code class="language-javascript">
									var caller = current.caller_id;
									var grAsset = new GlideRecord('alm_hardware');
									grAsset.addQuery('state', 'In use');
									grAsset.addQuery('assigned_to', caller);
									grAsset.addQuery('purpose', 'primary');
									grAsset.orderByDesc('retirement_date');
									grAsset.setLimit(1);
									grAsset.query();
										
									//Update associated computer with primary assigned asset
									if (grAsset.next()) {
										current.setValue('u_assoc_comp_ci', grAsset.ci);
										current.update();
										gs.addInfoMessage('Populated associated computer, please verify asset details.');
									} else {
										//Else update associated computer with assigned computer CI
										var grCompCI = new GlideRecord('cmdb_ci_computer');
										grCompCI.addQuery('assigned_to', caller);
										grCompCI.setLimit(1);
										grCompCI.query();
											
										if (grCompCI.next()) {
											current.setValue('u_assoc_comp_ci', grCompCI);
											current.update();
											gs.addInfoMessage('Populated associated computer, please verify asset details.');
										} else {
											gs.addInfoMessage('Unable to locate an assigned computer, please assign manaully.');
										}
									}
									action.setRedirectURL(current);
									</code>
								</pre>
							</article>

					</div>

				<!-- Footer -->
					<section id="footer">
						<ul class="icons">
							<li><a href="https://www.linkedin.com/in/jon-griffin-71124814" class="fab fa-linkedin-in"><span class="label">LinkedIn</span></a></li>
							<li><a href="mailto:jgriff@gmail.com?subject=ServiceNow Blog" class="icon solid fa-envelope"><span class="label">Email</span></a></li>
						</ul>
						<p class="copyright">&copy; Images: <a href="http://unsplash.com">Unsplash</a>.</p>
					</section>

			</div>

		<!-- Scripts -->
			<script src="assets/js/jquery.min.js"></script>
			<script src="assets/js/browser.min.js"></script>
			<script src="assets/js/breakpoints.min.js"></script>
			<script src="assets/js/util.js"></script>
			<script src="assets/js/main.js"></script>
			<script src="assets/js/prism.js"></script>

	</body>
	
</html>