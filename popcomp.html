<!DOCTYPE HTML>
<html>
	<head>
		<title>ITSM ServiceNow Blog by Jon Griffin</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="assets/css/main.css" />
	</head>
	<body class="single is-preload">

		<!-- Wrapper -->
			<div id="wrapper">

				<!-- Header -->
				<header id="header">
					<h1><a href="index.html">ITSM ServiceNow Blog</a></h1>
					<nav class="links">
						<ul>
							<li><a href="#">Business Rules</a></li>
							<li><a href="#">Client Scripts</a></li>
							<li><a href="#">UI Actions</a></li>
							<li><a href="#">Reporting</a></li>
							<li><a href="#">Other</a></li>
						</ul>
					</nav>
				</header>

				<!-- Menu -->
					<section id="menu">

						<!-- Links -->
							<section>
								<ul class="links">
									<li>
										<a href="#">
											<h3>Lorem ipsum</h3>
											<p>Feugiat tempus veroeros dolor</p>
										</a>
									</li>
									<li>
										<a href="#">
											<h3>Dolor sit amet</h3>
											<p>Sed vitae justo condimentum</p>
										</a>
									</li>
									<li>
										<a href="#">
											<h3>Feugiat veroeros</h3>
											<p>Phasellus sed ultricies mi congue</p>
										</a>
									</li>
									<li>
										<a href="#">
											<h3>Etiam sed consequat</h3>
											<p>Porta lectus amet ultricies</p>
										</a>
									</li>
								</ul>
							</section>

						<!-- Actions -->
							<section>
								<ul class="actions stacked">
									<li><a href="#" class="button large fit">Log In</a></li>
								</ul>
							</section>

					</section>

				<!-- Main -->
					<div id="main">

						<!-- Post -->
							<article class="post">
								<header>
									<div class="title">
										<h2><a href="#">Inform the help desk when computers are out of compliance</a></h2>
										<p>Inform & style the Incident task form for Windows 7 & unmanaged Mac's.</p>
									</div>
									<div class="meta">
										<time class="published" datetime="2019-08-01">August 1, 2019</time>
										<a href="#" class="author"><span class="name">JGriffin</span><img src="images/avatar.jpg" alt="" /></a>
									</div>
								</header>
								<!--<span class="image featured"><img src="images/pic01.jpg" alt="" /></span>-->
								<p>I created this UI action to automatically populate the computer associated with the task. This task is tedious to perform correctly
									and thus is often skipped or the wrong computer is selected. This script first checks the Hardware Asset table [alm_hardware] for
									primary assigned assets, if none are found it checks the CMDB CI Computer table [cmdb_ci_computer] for a computer they last logged into.
								</p>
								<pre>
									<code class="language-javascript">
									var caller = current.caller_id;
									var grAsset = new GlideRecord('alm_hardware');
									grAsset.addQuery('state', 'In use');
									grAsset.addQuery('assigned_to', caller);
									grAsset.addQuery('purpose', 'primary');
									grAsset.orderByDesc('retirement_date');
									grAsset.setLimit(1);
									grAsset.query();
										
									//Update associated computer with primary assigned asset
									if (grAsset.next()) {
										current.setValue('u_assoc_comp_ci', grAsset.ci);
										current.update();
										gs.addInfoMessage('Populated associated computer, please verify asset details.');
									} else {
										//Else update associated computer with assigned computer CI
										var grCompCI = new GlideRecord('cmdb_ci_computer');
										grCompCI.addQuery('assigned_to', caller);
										grCompCI.setLimit(1);
										grCompCI.query();
											
										if (grCompCI.next()) {
											current.setValue('u_assoc_comp_ci', grCompCI);
											current.update();
											gs.addInfoMessage('Populated associated computer, please verify asset details.');
										} else {
											gs.addInfoMessage('Unable to locate an assigned computer, please assign manaully.');
										}
									}
									action.setRedirectURL(current);
									</code>
								</pre>
							</article>

					</div>

				<!-- Footer -->
					<section id="footer">
						<ul class="icons">
							<li><a href="#" class="icon brands fa-twitter"><span class="label">Twitter</span></a></li>
							<li><a href="#" class="icon brands fa-facebook-f"><span class="label">Facebook</span></a></li>
							<li><a href="#" class="icon brands fa-instagram"><span class="label">Instagram</span></a></li>
							<li><a href="#" class="icon solid fa-rss"><span class="label">RSS</span></a></li>
							<li><a href="#" class="icon solid fa-envelope"><span class="label">Email</span></a></li>
						</ul>
						<p class="copyright">&copy; Untitled. Design: <a href="http://html5up.net">HTML5 UP</a>. Images: <a href="http://unsplash.com">Unsplash</a>.</p>
					</section>

			</div>

		<!-- Scripts -->
			<script src="assets/js/jquery.min.js"></script>
			<script src="assets/js/browser.min.js"></script>
			<script src="assets/js/breakpoints.min.js"></script>
			<script src="assets/js/util.js"></script>
			<script src="assets/js/main.js"></script>
			<script src="assets/js/prism.js"></script>

	</body>
</html>